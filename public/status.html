<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Status da Plataforma - OnlyFlow</title>
    <link rel="icon" href="/img/favicon.png" type="image/png" />
    <meta
      name="description"
      content="Status em tempo real dos serviços da plataforma OnlyFlow, incluindo API, disparo, MindOnlyFlow, gerenciador de Instagram e grupos."
    />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17651638692"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'AW-17651638692');
    </script>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/assets/js/tailwind-config.js"></script>
    <!-- Global Styles -->
    <link rel="stylesheet" href="/assets/css/style.css">
  </head>
  <body class="bg-slate-950 text-white antialiased" data-page="status">
    <!-- Background -->
    <div
      class="pointer-events-none fixed inset-0 -z-10 bg-gradient-to-b from-slate-950 via-slate-950 to-slate-950"
      aria-hidden="true"
    ></div>

    <!-- Page wrapper -->
    <div class="min-h-screen">
      <!-- Header -->
      <header
        class="sticky top-0 z-30 border-b border-white/5 bg-slate-950/80 backdrop-blur"
      >
        <div
          class="mx-auto flex max-w-6xl items-center justify-between px-4 py-3 sm:px-6 lg:px-8"
        >
          <!-- Logo -->
          <a href="/" class="flex items-center gap-2">
            <img src="/img/OnlyFlow-logo.png" alt="OnlyFlow" class="logo-dark h-8 w-auto" />
            <img src="/img/OnlyFlow-logo-claro.png" alt="OnlyFlow" class="logo-light h-8 w-auto" />
          </a>

          <!-- Actions -->
          <div class="flex items-center gap-3">
            <a
              href="https://app.onlyflow.com.br"
              class="hidden text-sm font-medium text-white/80 hover:text-white sm:inline"
              data-i18n="nav.enter"
              >Entrar</a
            >
            <a
              href="https://app.onlyflow.com.br/signup"
              class="hidden rounded-full bg-white px-4 py-1.5 text-sm font-semibold text-slate-950 shadow-sm hover:bg-slate-100 sm:inline"
              data-i18n="nav.startNow"
              >Começar agora</a
            >
            <!-- Theme toggle -->
            <button
              type="button"
              class="hidden rounded-full border border-white/15 px-3 py-1 text-xs font-medium text-white/80 hover:border-white/40 hover:text-white sm:inline-flex items-center gap-1"
              data-theme-toggle
              aria-label="Alternar tema claro/escuro"
            >
              <span class="theme-toggle-label">Tema claro</span>
            </button>
            <button
              type="button"
              class="inline-flex h-9 w-9 items-center justify-center rounded-full border border-white/10 text-white hover:border-white/40 md:hidden"
              aria-label="Abrir menu"
              onclick="document.getElementById('mobile-menu').classList.toggle('hidden')"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                class="h-5 w-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3.75 6.75h16.5M3.75 12h16.5M3.75 17.25h16.5"
                />
              </svg>
            </button>
          </div>
        </div>

        <!-- Mobile menu -->
        <div id="mobile-menu" class="hidden border-t border-white/5 md:hidden">
          <div class="mx-auto flex max-w-6xl flex-col gap-2 px-4 py-3">
            <div class="mt-2 flex flex-wrap gap-2">
              <a
                href="https://app.onlyflow.com.br"
                class="flex-1 rounded-full border border-white/15 px-4 py-1.5 text-center text-sm font-medium text-white/80"
                data-i18n="nav.enter"
                >Entrar</a
              >
              <a
                href="https://app.onlyflow.com.br/signup"
                class="flex-1 rounded-full bg-white px-4 py-1.5 text-center text-sm font-semibold text-slate-950"
                data-i18n="nav.startNow"
                >Começar agora</a
              >
            </div>
          </div>
        </div>
      </header>

      <main class="py-8 sm:py-10">
        <section class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8">
          <!-- Título -->
          <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <h1
                class="text-2xl font-semibold tracking-tight sm:text-3xl"
                data-i18n="status.title"
              >
                Status da Plataforma
              </h1>
              <p class="mt-1 text-sm text-white/70" data-i18n="status.description">
                Acompanhe em tempo real o status dos principais serviços da OnlyFlow.
              </p>
            </div>
            <div class="space-y-1 text-right text-xs text-white/60">
              <p id="last-updated"><span data-i18n="status.lastUpdate">Última atualização:</span> —</p>
              <button
                id="refresh-button"
                class="inline-flex items-center justify-center gap-1 rounded-full border border-white/15 px-3 py-1 text-[11px] font-medium text-white/80 hover:border-white/40"
              >
                <span data-i18n="status.refresh">Atualizar agora</span>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.5"
                  class="h-3.5 w-3.5"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M16.023 9.348h4.502V4.846M3.75 15.75v3.75h3.75M5.25 9.75A7.5 7.5 0 0 1 19.5 7.5M4.5 18.75A7.5 7.5 0 0 0 18.75 16.5"
                  />
                </svg>
              </button>
            </div>
          </div>

          <!-- Avisos -->
          <div id="global-status" class="mt-4 text-sm"></div>

          <!-- Cards -->
          <div
            id="services-grid"
            class="mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-3"
          >
            <!-- Cards serão preenchidos via JS -->
          </div>

          <!-- Erro -->
          <div
            id="error-box"
            class="mt-6 hidden rounded-2xl border border-red-500/40 bg-red-500/10 p-4 text-sm text-red-100"
          >
            <span data-i18n="status.error">Não foi possível carregar o status da plataforma. Tente novamente em alguns instantes.</span>
          </div>

          <!-- Rodapé pequeno -->
          <p class="mt-10 text-xs text-white/50">
            <span data-i18n="status.dataSource">Fonte dos dados:</span>
            <a
              href="https://back.onlyflow.com.br/api/public/status"
              class="text-primary-200 underline-offset-2 hover:underline"
              target="_blank"
              rel="noreferrer"
              data-i18n="status.apiLink"
              >API pública de status da OnlyFlow</a
            >.
          </p>
        </section>
      </main>

      <!-- Footer -->
      <footer class="border-t border-white/5 bg-slate-950/90 py-8">
        <div
          class="mx-auto flex max-w-6xl flex-col gap-4 px-4 text-xs text-white/60 sm:flex-row sm:items-center sm:justify-between sm:px-6 lg:px-8"
        >
          <div class="space-y-1">
            <div class="flex items-center gap-2">
              <img src="/img/OnlyFlow-logo.png" alt="OnlyFlow" class="logo-dark h-7 w-auto" />
              <img src="/img/OnlyFlow-logo-claro.png" alt="OnlyFlow" class="logo-light h-7 w-auto" />
              <span> • Plataforma de comunicação multicanal</span>
            </div>
            <p data-i18n="footer.copyright">© 2026 • Todos os direitos reservados.</p>
            <p class="text-white/50">
              <span data-i18n="footer.cnpj">CNPJ: 64.494.403/0001-17</span> • <span data-i18n="footer.phone">Tel: +55 62 99355-7070</span>
            </p>
          </div>
          <div class="flex flex-col items-start gap-2 text-xs sm:items-end">
            <div class="flex flex-wrap gap-4">
              <a
                href="/politica-privacidade"
                class="hover:text-primary-200"
                data-i18n="footer.privacy"
                >Política de Privacidade</a
              >
<a
              href="/termos"
              class="hover:text-primary-200"
              data-i18n="footer.terms"
              >Termos de Uso</a
            >
            <a
              href="/documentacao"
              class="hover:text-primary-200"
              data-i18n="footer.docs"
              >Documentação</a
            >
            </div>
            <div class="flex flex-wrap gap-3 text-white/70">
              <a
                href="https://facebook.com/onlyflow.hub"
                target="_blank"
                rel="noreferrer"
                class="hover:text-primary-200"
                >Facebook</a
              >
              <a
                href="https://instagram.com/onlyflow_hub"
                target="_blank"
                rel="noreferrer"
                class="hover:text-primary-200"
                >Instagram</a
              >
            </div>
          </div>
        </div>
      </footer>
    </div>

    <script>
      const ENDPOINT = 'https://back.onlyflow.com.br/api/public/status';

      // Services labels will be loaded from translations
      let servicesLabels = {};
      
      // Load translations for service labels
      async function loadServiceLabels() {
        try {
          const response = await fetch('/assets/translations/translations.json');
          const translations = await response.json();
          const lang = localStorage.getItem('onlyflow_language') || 'pt';
          if (translations[lang] && translations[lang].status && translations[lang].status.services) {
            servicesLabels = translations[lang].status.services;
          } else {
            // Fallback
            servicesLabels = {
              frontend: 'Página Principal',
              backend: 'API',
              dispatchOnlyFlow: 'Serviço de Disparo',
              mindOnlyFlow: 'Ferramenta MindOnlyFlow',
              instaOnlyFlow: 'Gerenciador de Instagram',
              grupoOnlyFlow: 'Gerenciador de Grupos'
            };
          }
        } catch (error) {
          console.error('Error loading service labels:', error);
          // Fallback
          servicesLabels = {
            frontend: 'Página Principal',
            backend: 'API',
            dispatchOnlyFlow: 'Serviço de Disparo',
            mindOnlyFlow: 'Ferramenta MindOnlyFlow',
            instaOnlyFlow: 'Gerenciador de Instagram',
            grupoOnlyFlow: 'Gerenciador de Grupos',
            scrapingOnlyFlow: 'Scraping OnlyFlow'
          };
        }
      }
      
      // Initialize labels
      loadServiceLabels();

      function formatDate(iso) {
        if (!iso) return '—';
        try {
          const d = new Date(iso);
          const lang = localStorage.getItem('onlyflow_language') || 'pt';
          const locale = lang === 'pt' ? 'pt-BR' : 'en-US';
          return d.toLocaleString(locale, {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
          });
        } catch {
          return iso;
        }
      }

      function createServiceCard(key, service) {
        const isOnline = (service.status || '').toLowerCase() === 'online';
        const statusColor = isOnline
          ? 'bg-emerald-500/15 text-emerald-200 border-emerald-400/40'
          : 'bg-red-500/15 text-red-100 border-red-400/40';

        const responseTime =
          typeof service.responseTime === 'number'
            ? service.responseTime + ' ms'
            : '—';

        // Get translated service name
        const serviceName = servicesLabels[key] || service.name || key;
        const lang = localStorage.getItem('onlyflow_language') || 'pt';
        const onlineText = lang === 'pt' ? 'Online' : 'Online';
        const offlineText = lang === 'pt' ? 'Offline' : 'Offline';

        const container = document.createElement('article');
        container.className =
          'flex flex-col rounded-2xl border border-white/10 bg-slate-900/80 p-4 text-sm text-white/80';

        container.innerHTML = `
          <div class="flex items-start justify-between gap-2">
            <div>
              <p class="text-xs font-semibold uppercase tracking-[0.16em] text-white/50">${serviceName}</p>
              <p class="mt-1 text-[13px] text-white/70">${service.message || ''}</p>
            </div>
            <span class="inline-flex items-center gap-1 rounded-full border ${statusColor} px-2.5 py-0.5 text-[11px] font-medium">
              <span class="h-1.5 w-1.5 rounded-full ${
                isOnline ? 'bg-emerald-400' : 'bg-red-400'
              }"></span>
              ${isOnline ? onlineText : offlineText}
            </span>
          </div>
          <dl class="mt-3 space-y-1.5 text-[11px] text-white/60">
            <div class="flex items-center justify-between">
            <dt class="text-white/50" data-i18n="status.responseTime">Tempo de resposta</dt>
            <dd class="text-white/80">${responseTime}</dd>
          </div>
          <div class="flex items-center justify-between">
            <dt class="text-white/50" data-i18n="status.lastCheck">Último check</dt>
            <dd class="text-white/80">${formatDate(service.timestamp)}</dd>
          </div>
            ${
              service.details && service.details.environment
                ? `<div class="flex items-center justify-between">
                    <dt class="text-white/50" data-i18n="status.environment">Ambiente</dt>
                    <dd class="text-white/80">${service.details.environment}</dd>
                   </div>`
                : ''
            }
          </dl>
        `;

        return container;
      }

      async function loadStatus() {
        const grid = document.getElementById('services-grid');
        const errorBox = document.getElementById('error-box');
        const lastUpdated = document.getElementById('last-updated');
        const globalStatus = document.getElementById('global-status');
        const refreshButton = document.getElementById('refresh-button');

        // Get language once at the beginning
        const lang = localStorage.getItem('onlyflow_language') || 'pt';
        const t = window.OnlyFlowLanguage?.t || ((key) => key);

        errorBox.classList.add('hidden');
        globalStatus.innerHTML = '';
        const loadingText = t('status.loading', lang) || 'Carregando status da plataforma...';
        grid.innerHTML = `<p class="col-span-full text-sm text-white/60">${loadingText}</p>`;
        refreshButton.disabled = true;
        refreshButton.classList.add('opacity-60', 'cursor-not-allowed');

        try {
          const res = await fetch(ENDPOINT, { cache: 'no-store' });
          if (!res.ok) {
            throw new Error('Resposta inválida da API');
          }
          const payload = await res.json();

          const data = payload.data || {};
          const services = data.services || {};

          // Atualiza horário geral
          const lastUpdateText = t('status.lastUpdate', lang) || 'Última atualização:';
          lastUpdated.innerHTML = `<span data-i18n="status.lastUpdate">${lastUpdateText}</span> ${formatDate(data.timestamp)}`;

          // Verifica se algum serviço está offline
          const entries = Object.entries(services);
          const anyOffline = entries.some(
            ([_, s]) => (s.status || '').toLowerCase() !== 'online'
          );
          
          if (entries.length === 0) {
            globalStatus.innerHTML = `<p class="rounded-xl border border-amber-400/40 bg-amber-500/10 px-3 py-2 text-xs text-amber-100">${t('status.noServices', lang)}</p>`;
          } else if (!anyOffline) {
            globalStatus.innerHTML = `<p class="inline-flex items-center gap-2 rounded-full border border-emerald-400/40 bg-emerald-500/10 px-3 py-1.5 text-xs font-medium text-emerald-100"><span class="h-1.5 w-1.5 rounded-full bg-emerald-400"></span>${t('status.allOnline', lang)}</p>`;
          } else {
            globalStatus.innerHTML = `<p class="rounded-xl border border-amber-400/40 bg-amber-500/10 px-3 py-2 text-xs text-amber-100">${t('status.someIssues', lang)}</p>`;
          }

          // Load service labels before rendering
          await loadServiceLabels();
          
          // Renderiza cards
          grid.innerHTML = '';
          // Garante ordem amigável
          const order = [
            'frontend',
            'backend',
            'dispatchOnlyFlow',
            'mindOnlyFlow',
            'instaOnlyFlow',
            'grupoOnlyFlow'
          ];
          for (const key of order) {
            if (services[key]) {
              grid.appendChild(createServiceCard(key, services[key]));
            }
          }
          // Caso a API traga mais serviços no futuro
          for (const [key, service] of Object.entries(services)) {
            if (!order.includes(key)) {
              grid.appendChild(createServiceCard(key, service));
            }
          }
        } catch (e) {
          console.error('Erro ao carregar status:', e);
          errorBox.classList.remove('hidden');
          grid.innerHTML = '';
          const lastUpdateText = t('status.lastUpdate', lang) || 'Última atualização:';
          lastUpdated.innerHTML = `<span data-i18n="status.lastUpdate">${lastUpdateText}</span> falha ao carregar`;
        } finally {
          refreshButton.disabled = false;
          refreshButton.classList.remove('opacity-60', 'cursor-not-allowed');
        }
      }

      document
        .getElementById('refresh-button')
        .addEventListener('click', loadStatus);

      // Carrega automaticamente ao abrir a página
      loadStatus();
    </script>
    <!-- Theme -->
    <script src="/assets/js/theme.js"></script>
    <!-- Smooth Scroll -->
    <script src="/assets/js/smooth-scroll.js"></script>
    <!-- Language Switcher -->
    <script src="/assets/js/language.js"></script>
  </body>
</html>

